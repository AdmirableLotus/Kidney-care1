import React, { useState } from 'react';
import { logFood } from '../api';
import './FoodLogForm.css';

const FoodLogForm = () => {
  const [formData, setFormData] = useState({
    meal: '',
    description: '',
    protein: '',
    phosphorus: '',
    sodium: '',
    potassium: '',
    date: new Date().toISOString().split('T')[0]
  });
  const [success, setSuccess] = useState('');
  const [error, setError] = useState('');

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData((f) => ({ ...f, [name]: value }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setSuccess('');
    setError('');
    try {
      await logFood(formData);
      setSuccess('Food logged successfully.');
      setFormData({
        meal: '',
        description: '',
        protein: '',
        phosphorus: '',
        sodium: '',
        potassium: '',
        date: new Date().toISOString().split('T')[0]
      });
    } catch (err) {
      setError(err.message || 'Something went wrong.');
    }
  };

  return (
    <div className="food-log-form">
      <h3>Log Your Food</h3>
      {error && <div className="error">{error}</div>}
      {success && <div className="success">{success}</div>}
      <form onSubmit={handleSubmit}>
        <div className="form-group">
          <label>Meal Type</label>
          <select name="meal" value={formData.meal} onChange={handleChange} required>
            <option value="">-- Select --</option>
            <option value="breakfast">Breakfast</option>
            <option value="lunch">Lunch</option>
            <option value="dinner">Dinner</option>
            <option value="snack">Snack</option>
          </select>
        </div>

        <div className="form-group">
          <label>What did you eat?</label>
          <input type="text" name="description" value={formData.description} onChange={handleChange} required />
        </div>

        <div className="nutrients-container">
          <h4>Estimate Nutrients</h4>
          <div className="nutrient-grid">
            <div>
              <label>Protein (g)</label>
              <input type="number" name="protein" value={formData.protein} onChange={handleChange} />
            </div>
            <div>
              <label>Phosphorus (mg)</label>
              <input type="number" name="phosphorus" value={formData.phosphorus} onChange={handleChange} />
            </div>
            <div>
              <label>Sodium (mg)</label>
              <input type="number" name="sodium" value={formData.sodium} onChange={handleChange} />
            </div>
            <div>
              <label>Potassium (mg)</label>
              <input type="number" name="potassium" value={formData.potassium} onChange={handleChange} />
            </div>
          </div>
        </div>

        <div className="form-group">
          <label>Date</label>
          <input type="date" name="date" value={formData.date} onChange={handleChange} required />
        </div>

        <button type="submit">Log Food</button>
      </form>
    </div>
  );
};

export default FoodLogForm;
